var searchBtn=document.querySelector(".search-start");var searchClear=document.querySelector(".search-clear");var searchInput=document.querySelector(".search-input");var searchResults=document.querySelector(".search-results");var searchValue="",arrItems=[],arrContents=[],arrLinks=[],arrTitles=[],arrResults=[],indexItem=[];var tmpDiv=document.createElement("div");tmpDiv.className="result-item";var xhr=new XMLHttpRequest()||new ActiveXObject("Microsoft.XMLHTTP");xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){xml=xhr.responseXML;arrItems=xml.getElementsByTagName("entry");for(i=0;i<arrItems.length;i++){arrContents[i]=arrItems[i].getElementsByTagName("content")[0].childNodes[0].nodeValue;arrLinks[i]=arrItems[i].getElementsByTagName("id")[0].childNodes[0].nodeValue.replace(/\s+/g,"");arrTitles[i]=arrItems[i].getElementsByTagName("title")[0].childNodes[0].nodeValue}}};xhr.open("get","/atom.xml",true);xhr.send();searchBtn.onclick=searchConfirm;searchClear.onclick=function(){searchInput.value="";searchResults.style.display="none";searchClear.style.display="none"};searchInput.onkeydown=function(){setTimeout(searchConfirm,0)};searchInput.onfocus=function(){searchResults.style.display="block"};function searchConfirm(){if(searchInput.value==""){searchResults.style.display="none";searchClear.style.display="none"}else{if(searchInput.value.search(/^\s+$/)>=0){searchInit();var itemDiv=tmpDiv.cloneNode(true);itemDiv.innerText="请输入有效内容...";searchResults.appendChild(itemDiv)}else{searchInit();searchValue=searchInput.value;searchMatching(arrContents,searchValue)}}}function searchInit(){arrResults=[];indexItem=[];searchResults.innerHTML="";searchResults.style.display="block";searchClear.style.display="block"}function searchMatching(arr,input){for(i=0;i<arr.length;i++){if(arr[i].search(input)!=-1){indexItem.push(i);var indexContent=arr[i].search(input);var l=input.length;var step=10;arrResults.push(arr[i].slice(indexContent-step,indexContent)+"<mark>"+arr[i].slice(indexContent,indexContent+l)+"</mark>"+arr[i].slice(indexContent+l,indexContent+l+step))}}var totalDiv=tmpDiv.cloneNode(true);totalDiv.innerHTML="总匹配：<b>"+indexItem.length+"</b> 项";searchResults.appendChild(totalDiv);if(indexItem.length==0){var itemDiv=tmpDiv.cloneNode(true);itemDiv.innerText="未匹配到内容...";searchResults.appendChild(itemDiv)}for(i=0;i<arrResults.length;i++){var itemDiv=tmpDiv.cloneNode(true);itemDiv.innerHTML="<b>《"+arrTitles[indexItem[i]]+"》</b><hr />"+arrResults[i];itemDiv.setAttribute("onclick","changeHref(arrLinks[indexItem["+i+"]])");searchResults.appendChild(itemDiv)}}function changeHref(href){window.open(href)};